# ğŸ—ï¸ æ¶æ„ä¸è°ƒç”¨å…³ç³»å›¾

## ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·ç•Œé¢ (Frontend)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  èŠå¤©ç•Œé¢    â”‚  â”‚ åŒ»å­¦å¯è§†åŒ–  â”‚  â”‚  è¯Šæ–­æ¨¡æ‹Ÿæ¸¸æˆç•Œé¢        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Nexent Runtime                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚              ç—…ç†å­¦AIåŠ©æ‰‹ (Agent ID: 13)                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MCP å·¥å…·å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚      å†…ç½®å·¥å…·         â”‚  â”‚        è‡ªå®šä¹‰åŒ»ç–—å·¥å…·         â”‚     â”‚
â”‚  â”‚  â€¢ knowledge_search  â”‚  â”‚  â€¢ chain_of_diagnosis        â”‚     â”‚
â”‚  â”‚  â€¢ tavily_search     â”‚  â”‚  â€¢ evaluate_confidence       â”‚     â”‚
â”‚  â”‚  â€¢ analyze_image     â”‚  â”‚  â€¢ diagnosis_game            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ•°æ®å±‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ PostgreSQL  â”‚  â”‚Elasticsearchâ”‚  â”‚    ç—…ç†å›¾ç‰‡æœåŠ¡å™¨        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å·¥å…·è°ƒç”¨å…³ç³»å›¾ (Mermaid)

```mermaid
flowchart TD
    subgraph User["ğŸ‘¤ ç”¨æˆ·"]
        Q[ç”¨æˆ·æé—®]
    end

    subgraph Agent["ğŸ¤– ç—…ç†å­¦AIåŠ©æ‰‹ Agent ID:13"]
        A[æ¥æ”¶é—®é¢˜]
        B{åˆ¤æ–­é—®é¢˜ç±»å‹}
    end

    subgraph BuiltIn["ğŸ“¦ å†…ç½®å·¥å…·"]
        KB[knowledge_base_search<br/>å†…éƒ¨çŸ¥è¯†åº“ 60%]
        TS[tavily_search<br/>å¤–éƒ¨æœç´¢ 40%]
        AI[analyze_image<br/>å›¾ç‰‡åˆ†æ]
    end

    subgraph Medical["ğŸ¥ åŒ»ç–—è¯Šæ–­å·¥å…·"]
        COD[chain_of_diagnosis<br/>5æ­¥è¯Šæ–­æ¨ç†é“¾]
        CONF[evaluate_diagnosis_confidence<br/>ç½®ä¿¡åº¦è¯„ä¼°]
        IMG[search_pathology_images<br/>ç—…ç†å›¾ç‰‡æœç´¢]
        GUIDE[generate_medical_guide<br/>å°±åŒ»æŒ‡å—]
    end

    subgraph Game["ğŸ® è¯Šæ–­æ¨¡æ‹Ÿæ¸¸æˆ"]
        START[start_diagnosis_game<br/>å¯åŠ¨æ¸¸æˆ]
        ACTION[diagnosis_action<br/>é—®è¯Š/ä½“æ£€/æ£€æŸ¥/è¯Šæ–­]
    end

    subgraph Visual["ğŸ“Š åŒ»å­¦å¯è§†åŒ–å·¥å…·"]
        KG[generate_knowledge_graph<br/>çŸ¥è¯†å›¾è°±]
        FLOW[generate_diagnosis_flow<br/>è¯Šæ–­æµç¨‹å›¾]
        CHART[generate_medical_chart<br/>ç»Ÿè®¡å›¾è¡¨]
        RADAR[generate_radar_chart<br/>é›·è¾¾å›¾]
        TL[generate_timeline<br/>æ—¶é—´çº¿]
        GANTT[generate_gantt_chart<br/>ç”˜ç‰¹å›¾]
        QUAD[generate_quadrant_chart<br/>è±¡é™å›¾]
        STATE[generate_state_diagram<br/>çŠ¶æ€å›¾]
        SANKEY[generate_sankey_diagram<br/>æ¡‘åŸºå›¾]
    end

    Q --> A
    A --> B
    B -->|åŒ»å­¦é—®ç­”| KB
    B -->|åŒ»å­¦é—®ç­”| TS
    B -->|å›¾ç‰‡åˆ†æ| AI
    B -->|è¯Šæ–­åˆ†æ| COD
    B -->|è¯Šæ–­æ¸¸æˆ| START
    B -->|å¯è§†åŒ–| KG
    B -->|å°±åŒ»å’¨è¯¢| GUIDE
    
    KB --> R[ç”Ÿæˆå›ç­”]
    TS --> R
    AI --> R
    COD --> CONF --> R
    START --> ACTION --> R
    KG --> R
    FLOW --> R
    CHART --> R
    RADAR --> R
    TL --> R
    GANTT --> R
    QUAD --> R
    STATE --> R
    SANKEY --> R
    IMG --> R
    GUIDE --> R
```

---

## å®Œæ•´å·¥å…·è°ƒç”¨æµç¨‹å›¾

```mermaid
flowchart LR
    subgraph Input["è¾“å…¥"]
        U[ç”¨æˆ·é—®é¢˜]
    end

    subgraph Process["å¤„ç†æµç¨‹"]
        U --> Agent[ç—…ç†å­¦AIåŠ©æ‰‹]
        Agent --> Parse{è§£ææ„å›¾}
        
        Parse -->|çŸ¥è¯†æŸ¥è¯¢| Search["åŒé‡æ£€ç´¢"]
        Parse -->|è¯Šæ–­è¯·æ±‚| Diag["è¯Šæ–­åˆ†æ"]
        Parse -->|æ¸¸æˆè¯·æ±‚| Game["è¯Šæ–­æ¸¸æˆ"]
        Parse -->|å¯è§†åŒ–| Viz["å›¾è¡¨ç”Ÿæˆ"]
        Parse -->|å°±åŒ»å’¨è¯¢| Guide["å°±åŒ»æŒ‡å—"]
        
        Search --> KB[å†…éƒ¨çŸ¥è¯†åº“]
        Search --> Web[å¤–éƒ¨æœç´¢]
        
        Diag --> CoD[CoDæ¨ç†é“¾]
        CoD --> Eval[ç½®ä¿¡åº¦è¯„ä¼°]
        
        Game --> Start[å¯åŠ¨æ¸¸æˆ]
        Start --> Action[æ‰§è¡ŒåŠ¨ä½œ]
        
        Viz --> Charts[9ç§å›¾è¡¨å·¥å…·]
    end

    subgraph Output["è¾“å‡º"]
        KB --> Merge[ç»“æœèåˆ]
        Web --> Merge
        Eval --> Merge
        Action --> Merge
        Charts --> Merge
        Guide --> Merge
        Merge --> Response[AIå›ç­”]
    end
```

---

## è¯Šæ–­æ¸¸æˆæµç¨‹å›¾

```mermaid
flowchart LR
    A[å¯åŠ¨æ¸¸æˆ] --> B[é—®è¯Šé˜¶æ®µ]
    B --> C[ä½“æ ¼æ£€æŸ¥]
    C --> D[è¾…åŠ©æ£€æŸ¥]
    D --> E[ç»™å‡ºè¯Šæ–­]
    E --> F[è¯„åˆ†åé¦ˆ]
```

---

## Chain-of-Diagnosis æµç¨‹

```mermaid
flowchart TD
    INPUT[è¾“å…¥ç—‡çŠ¶] --> S1[Step1: ç—‡çŠ¶åˆ†æ]
    S1 --> S2[Step2: ç—…å²å…³è”]
    S2 --> S3[Step3: é‰´åˆ«è¯Šæ–­]
    S3 --> S4[Step4: æ£€æŸ¥å»ºè®®]
    S4 --> S5[Step5: åˆæ­¥ç»“è®º]
    S5 --> EVAL[ç½®ä¿¡åº¦è¯„ä¼°]
    EVAL --> OUTPUT[è¯Šæ–­æŠ¥å‘Š]
```

---

## å‰ç«¯ç»„ä»¶è°ƒç”¨å…³ç³»

```mermaid
flowchart TD
    subgraph Chat["èŠå¤©ç•Œé¢"]
        CI[chatInterface.tsx]
        MD[markdownRenderer.tsx]
    end

    subgraph MedViz["åŒ»å­¦å¯è§†åŒ–ç»„ä»¶"]
        MVP[MedicalVisualizationPanel]
        PIG[PathologyImageGallery]
        DCC[DiagnosisConfidenceCard]
        ST[SourceTag]
    end

    subgraph Services["æœåŠ¡å±‚"]
        CS[conversationService.ts]
    end

    CI --> MD
    MD -->|æ¸²æŸ“Mermaid| MVP
    MD -->|æ¸²æŸ“å›¾ç‰‡| PIG
    MD -->|æ¸²æŸ“ç½®ä¿¡åº¦| DCC
    MD -->|æ¸²æŸ“æ¥æº| ST
    MD -->|[btn:xx]æŒ‰é’®| BTN[ClickableOption]
    
    CI --> CS
    CS -->|deleteAll| API[åç«¯API]
```

---

## MCPå·¥å…·æ³¨å†Œå…³ç³»

```mermaid
flowchart TD
    subgraph MCP["FastMCPæ¡†æ¶"]
        LMS[local_mcp_service.py]
    end

    subgraph Decorator["@local_mcp_service.tool è£…é¥°å™¨"]
        D1[åŒ»ç–—è¯Šæ–­å·¥å…· x4]
        D2[è¯Šæ–­æ¸¸æˆå·¥å…· x2]
        D3[å¯è§†åŒ–å·¥å…· x9]
    end

    subgraph Runtime["Nexent Runtime"]
        Agent[ç—…ç†å­¦AIåŠ©æ‰‹]
    end

    LMS --> D1
    LMS --> D2
    LMS --> D3
    
    D1 --> Agent
    D2 --> Agent
    D3 --> Agent
```

---

## æ•°æ®æµå‘å›¾

```mermaid
flowchart LR
    subgraph Input["ç”¨æˆ·è¾“å…¥"]
        Text[æ–‡æœ¬é—®é¢˜]
        Image[ç—…ç†å›¾ç‰‡]
        Click[æŒ‰é’®ç‚¹å‡»]
    end

    subgraph Process["Agentå¤„ç†"]
        Text --> Agent[ç—…ç†å­¦AIåŠ©æ‰‹]
        Image --> Agent
        Click --> Agent
        
        Agent --> Tools[MCPå·¥å…·]
        Tools --> KB[(çŸ¥è¯†åº“)]
        Tools --> Web((äº’è”ç½‘))
        Tools --> ImgDB[(å›¾ç‰‡åº“)]
    end

    subgraph Output["è¾“å‡º"]
        KB --> Response
        Web --> Response
        ImgDB --> Response
        Response[AIå›ç­”] --> Render[å‰ç«¯æ¸²æŸ“]
        Render --> Markdown[æ–‡æœ¬/è¡¨æ ¼]
        Render --> Mermaid[å›¾è¡¨]
        Render --> Images[å›¾ç‰‡]
        Render --> Buttons[äº¤äº’æŒ‰é’®]
    end
```

---

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

### åç«¯ä¿®æ”¹

| æ–‡ä»¶ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `backend/tool_collection/mcp/local_mcp_service.py` | æ–°å¢ | 15ä¸ªåŒ»ç–—MCPå·¥å…· |

### å‰ç«¯ä¿®æ”¹

| æ–‡ä»¶ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `frontend/components/medical-visualization/PathologyImageGallery.tsx` | æ–°å¢ | ç—…ç†å›¾ç‰‡ç”»å»Š |
| `frontend/components/medical-visualization/DiagnosisConfidenceCard.tsx` | æ–°å¢ | ç½®ä¿¡åº¦å¡ç‰‡ |
| `frontend/components/medical-visualization/SourceTag.tsx` | æ–°å¢ | æ¥æºæ ‡ç­¾ |
| `frontend/components/medical-visualization/MedicalVisualizationPanel.tsx` | ä¿®æ”¹ | å»é™¤ç¡¬ç¼–ç  |
| `frontend/components/ui/markdownRenderer.tsx` | ä¿®æ”¹ | [btn:xx]æŒ‰é’®è§£æ |
| `frontend/app/[locale]/chat/components/chatLeftSidebar.tsx` | ä¿®æ”¹ | æ¸…ç©ºå¯¹è¯æŒ‰é’® |
| `frontend/services/conversationService.ts` | ä¿®æ”¹ | deleteAllæ–¹æ³• |

### é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `docker/update_prompt_btn.sql` | Agentæç¤ºè¯é…ç½® |
